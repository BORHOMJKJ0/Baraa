{
    "sourceFile": "app/Traits/AuthTrait.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 8,
            "patches": [
                {
                    "date": 1746898678441,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1746898690059,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -29,9 +29,9 @@\n     public function checkProduct($model, $modelType, $action)\n     {\n         $hasProducts = Store::where('category_id', $model->id)->exists();\n \n-        $userHasStoreInCategory = Store::where('category_id', $model->id)\n+        $userHasProductInCategory = Store::where('category_id', $model->id)\n             ->where('user_id', auth()->id())\n             ->exists();\n         if ($action == 'delete' && $hasProducts) {\n             $productNotOwnedByUser = Store::where('category_id', $model->id)->where('user_id', '!=', auth()->id())->exists();\n"
                },
                {
                    "date": 1746898748530,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -29,17 +29,17 @@\n     public function checkProduct($model, $modelType, $action)\n     {\n         $hasProducts = Store::where('category_id', $model->id)->exists();\n \n-        $userHasProductInCategory = Store::where('category_id', $model->id)\n+        $userHasProductInCStore = Store::where('category_id', $model->id)\n             ->where('user_id', auth()->id())\n             ->exists();\n         if ($action == 'delete' && $hasProducts) {\n             $productNotOwnedByUser = Store::where('category_id', $model->id)->where('user_id', '!=', auth()->id())->exists();\n             if ($productNotOwnedByUser) {\n                 throw new HttpResponseException(ResponseHelper::jsonResponse(\n                     [],\n-                    \"You are not authorized to {$action} this {$modelType}. This store have product from other users.\",\n+                    \"You are not authorized to {$action} this {$modelType}. This store have products from other users.\",\n                     403,\n                     false\n                 ));\n             }\n"
                },
                {
                    "date": 1746898927297,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -27,16 +27,9 @@\n     }\n \n     public function checkProduct($model, $modelType, $action)\n     {\n-        $hasProducts = Store::where('category_id', $model->id)->exists();\n-\n-        $userHasProductInCStore = Store::where('category_id', $model->id)\n-            ->where('user_id', auth()->id())\n-            ->exists();\n-        if ($action == 'delete' && $hasProducts) {\n-            $productNotOwnedByUser = Store::where('category_id', $model->id)->where('user_id', '!=', auth()->id())->exists();\n-            if ($productNotOwnedByUser) {\n+        if ($product->store->user_id !== auth()->id()) {\n                 throw new HttpResponseException(ResponseHelper::jsonResponse(\n                     [],\n                     \"You are not authorized to {$action} this {$modelType}. This store have products from other users.\",\n                     403,\n"
                },
                {
                    "date": 1746898934906,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,39 @@\n+<?php\n+\n+namespace App\\Traits;\n+\n+use App\\Helpers\\ResponseHelper;\n+use App\\Models\\Store\\Store;\n+use Illuminate\\Http\\Exceptions\\HttpResponseException;\n+\n+trait AuthTrait\n+{\n+    public function checkOwnership($model, $modelType, $action, $relation = null, $relationName = null)\n+    {\n+        if ($relation) {\n+            if ($model->$relation()->exists()) {\n+                $unauthorizedDebts = $model->$relation()->where('user_id', '!=', auth()->id())->exists();\n+                if ($unauthorizedDebts) {\n+                    throw new HttpResponseException(ResponseHelper::jsonResponse([],\n+                        \"You are not authorized to {$action} this {$modelType}. It has associated {$relationName}.\",\n+                        403, false));\n+                }\n+            }\n+        } elseif ($model->user_id !== auth()->id()) {\n+            throw new HttpResponseException(ResponseHelper::jsonResponse([],\n+                \"You are not authorized to {$action} this {$modelType}.\",\n+                403, false));\n+        }\n+    }\n+\n+    public function checkProduct($model, $modelType, $action)\n+    {\n+        if ($product->store->user_id !== auth()->id()) {\n+                throw new HttpResponseException(ResponseHelper::jsonResponse(\n+                    [],\n+                    \"You are not authorized to {$action} this {$modelType}. This store have products from other users.\",\n+                    403,\n+                    false\n+                ));\n+            }\n+}\n\\ No newline at end of file\n"
                },
                {
                    "date": 1746898940344,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -34,5 +34,7 @@\n                     \"You are not authorized to {$action} this {$modelType}. This store have products from other users.\",\n                     403,\n                     false\n                 ));\n-            }\n\\ No newline at end of file\n+            }\n+        }\n+    }\n\\ No newline at end of file\n"
                },
                {
                    "date": 1746898952939,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,40 @@\n+<?php\n+\n+namespace App\\Traits;\n+\n+use App\\Helpers\\ResponseHelper;\n+use App\\Models\\Store\\Store;\n+use Illuminate\\Http\\Exceptions\\HttpResponseException;\n+\n+trait AuthTrait\n+{\n+    public function checkOwnership($model, $modelType, $action, $relation = null, $relationName = null)\n+    {\n+        if ($relation) {\n+            if ($model->$relation()->exists()) {\n+                $unauthorizedDebts = $model->$relation()->where('user_id', '!=', auth()->id())->exists();\n+                if ($unauthorizedDebts) {\n+                    throw new HttpResponseException(ResponseHelper::jsonResponse([],\n+                        \"You are not authorized to {$action} this {$modelType}. It has associated {$relationName}.\",\n+                        403, false));\n+                }\n+            }\n+        } elseif ($model->user_id !== auth()->id()) {\n+            throw new HttpResponseException(ResponseHelper::jsonResponse([],\n+                \"You are not authorized to {$action} this {$modelType}.\",\n+                403, false));\n+        }\n+    }\n+\n+    public function checkProduct($model, $modelType, $action)\n+    {\n+        if ($product->store->user_id !== auth()->id()) {\n+                throw new HttpResponseException(ResponseHelper::jsonResponse(\n+                    [],\n+                    \"You are not authorized to {$action} this {$modelType}.This Product not in Your Store \",\n+                    403,\n+                    false\n+                ));\n+            }\n+        }\n+    }\n\\ No newline at end of file\n"
                },
                {
                    "date": 1746899046801,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,55 @@\n+<?php\n+\n+namespace App\\Traits;\n+\n+use App\\Helpers\\ResponseHelper;\n+use App\\Models\\Store\\Store;\n+use Illuminate\\Http\\Exceptions\\HttpResponseException;\n+\n+trait AuthTrait\n+{\n+    public function checkOwnership($model, $modelType, $action, $relation = null, $relationName = null)\n+    {\n+        if ($relation) {\n+            if ($model->$relation()->exists()) {\n+                $unauthorizedDebts = $model->$relation()->where('user_id', '!=', auth()->id())->exists();\n+                if ($unauthorizedDebts) {\n+                    throw new HttpResponseException(ResponseHelper::jsonResponse([],\n+                        \"You are not authorized to {$action} this {$modelType}. It has associated {$relationName}.\",\n+                        403, false));\n+                }\n+            }\n+        } elseif ($model->user_id !== auth()->id()) {\n+            throw new HttpResponseException(ResponseHelper::jsonResponse([],\n+                \"You are not authorized to {$action} this {$modelType}.\",\n+                403, false));\n+        }\n+    }\n+\n+    public function checkProduct($model, $modelType, $action)\n+    {\n+        if ($product->store->user_id !== auth()->id()) {\n+                throw new HttpResponseException(ResponseHelper::jsonResponse(\n+                    [],\n+                    \"You are not authorized to {$action} this {$modelType}.This Product not in your Store \",\n+                    403,\n+                    false\n+                ));\n+            }\n+        }\n+        public function checkProduct($storeId, $modelType, $action)\n+{\n+    $store = Store::where('id', $storeId)\n+        ->where('user_id', auth()->id())\n+        ->first();\n+\n+    if (!$store) {\n+        throw new HttpResponseException(ResponseHelper::jsonResponse(\n+            [],\n+            \"You are not authorized to {$action} this {$modelType}. This store does not belong to you.\",\n+            403,\n+            false\n+        ));\n+    }\n+}\n+    }\n\\ No newline at end of file\n"
                },
                {
                    "date": 1746899054355,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -36,9 +36,9 @@\n                     false\n                 ));\n             }\n         }\n-        public function checkProduct($storeId, $modelType, $action)\n+        public function checkStoreID($storeId, $modelType, $action)\n {\n     $store = Store::where('id', $storeId)\n         ->where('user_id', auth()->id())\n         ->first();\n@@ -51,135 +51,5 @@\n             false\n         ));\n     }\n }\n-    }\n-<?php\n-\n-namespace App\\Traits;\n-\n-use App\\Helpers\\ResponseHelper;\n-use App\\Models\\Store\\Store;\n-use Illuminate\\Http\\Exceptions\\HttpResponseException;\n-\n-trait AuthTrait\n-{\n-    public function checkOwnership($model, $modelType, $action, $relation = null, $relationName = null)\n-    {\n-        if ($relation) {\n-            if ($model->$relation()->exists()) {\n-                $unauthorizedDebts = $model->$relation()->where('user_id', '!=', auth()->id())->exists();\n-                if ($unauthorizedDebts) {\n-                    throw new HttpResponseException(ResponseHelper::jsonResponse([],\n-                        \"You are not authorized to {$action} this {$modelType}. It has associated {$relationName}.\",\n-                        403, false));\n-                }\n-            }\n-        } elseif ($model->user_id !== auth()->id()) {\n-            throw new HttpResponseException(ResponseHelper::jsonResponse([],\n-                \"You are not authorized to {$action} this {$modelType}.\",\n-                403, false));\n-        }\n-    }\n-\n-    public function checkProduct($model, $modelType, $action)\n-    {\n-        if ($product->store->user_id !== auth()->id()) {\n-                throw new HttpResponseException(ResponseHelper::jsonResponse(\n-                    [],\n-                    \"You are not authorized to {$action} this {$modelType}.This Product not in Your Store \",\n-                    403,\n-                    false\n-                ));\n-            }\n-        }\n-    }\n-<?php\n-\n-namespace App\\Traits;\n-\n-use App\\Helpers\\ResponseHelper;\n-use App\\Models\\Store\\Store;\n-use Illuminate\\Http\\Exceptions\\HttpResponseException;\n-\n-trait AuthTrait\n-{\n-    public function checkOwnership($model, $modelType, $action, $relation = null, $relationName = null)\n-    {\n-        if ($relation) {\n-            if ($model->$relation()->exists()) {\n-                $unauthorizedDebts = $model->$relation()->where('user_id', '!=', auth()->id())->exists();\n-                if ($unauthorizedDebts) {\n-                    throw new HttpResponseException(ResponseHelper::jsonResponse([],\n-                        \"You are not authorized to {$action} this {$modelType}. It has associated {$relationName}.\",\n-                        403, false));\n-                }\n-            }\n-        } elseif ($model->user_id !== auth()->id()) {\n-            throw new HttpResponseException(ResponseHelper::jsonResponse([],\n-                \"You are not authorized to {$action} this {$modelType}.\",\n-                403, false));\n-        }\n-    }\n-\n-    public function checkProduct($model, $modelType, $action)\n-    {\n-        if ($product->store->user_id !== auth()->id()) {\n-                throw new HttpResponseException(ResponseHelper::jsonResponse(\n-                    [],\n-                    \"You are not authorized to {$action} this {$modelType}. This store have products from other users.\",\n-                    403,\n-                    false\n-                ));\n-            }\n-        }\n-    }\n-}\n-<?php\n-\n-namespace App\\Traits;\n-\n-use App\\Helpers\\ResponseHelper;\n-use App\\Models\\Store\\Store;\n-use Illuminate\\Http\\Exceptions\\HttpResponseException;\n-\n-trait AuthTrait\n-{\n-    public function checkOwnership($model, $modelType, $action, $relation = null, $relationName = null)\n-    {\n-        if ($relation) {\n-            if ($model->$relation()->exists()) {\n-                $unauthorizedDebts = $model->$relation()->where('user_id', '!=', auth()->id())->exists();\n-                if ($unauthorizedDebts) {\n-                    throw new HttpResponseException(ResponseHelper::jsonResponse([],\n-                        \"You are not authorized to {$action} this {$modelType}. It has associated {$relationName}.\",\n-                        403, false));\n-                }\n-            }\n-        } elseif ($model->user_id !== auth()->id()) {\n-            throw new HttpResponseException(ResponseHelper::jsonResponse([],\n-                \"You are not authorized to {$action} this {$modelType}.\",\n-                403, false));\n-        }\n-    }\n-\n-    public function checkProduct($model, $modelType, $action)\n-    {\n-        if ($product->store->user_id !== auth()->id()) {\n-                throw new HttpResponseException(ResponseHelper::jsonResponse(\n-                    [],\n-                    \"You are not authorized to {$action} this {$modelType}. This store have products from other users.\",\n-                    403,\n-                    false\n-                ));\n-            }\n-        }\n-        if ($hasProducts && ! $userHasStoreInCategory && $action == 'update') {\n-            throw new HttpResponseException(ResponseHelper::jsonResponse(\n-                [],\n-                \"You are not authorized to {$action} this {$modelType}. You must have products in this category.\",\n-                403,\n-                false\n-            ));\n-        }\n-    }\n-}\n\\ No newline at end of file\n+    }\n\\ No newline at end of file\n"
                }
            ],
            "date": 1746898678441,
            "name": "Commit-0",
            "content": "<?php\n\nnamespace App\\Traits;\n\nuse App\\Helpers\\ResponseHelper;\nuse App\\Models\\Store\\Store;\nuse Illuminate\\Http\\Exceptions\\HttpResponseException;\n\ntrait AuthTrait\n{\n    public function checkOwnership($model, $modelType, $action, $relation = null, $relationName = null)\n    {\n        if ($relation) {\n            if ($model->$relation()->exists()) {\n                $unauthorizedDebts = $model->$relation()->where('user_id', '!=', auth()->id())->exists();\n                if ($unauthorizedDebts) {\n                    throw new HttpResponseException(ResponseHelper::jsonResponse([],\n                        \"You are not authorized to {$action} this {$modelType}. It has associated {$relationName}.\",\n                        403, false));\n                }\n            }\n        } elseif ($model->user_id !== auth()->id()) {\n            throw new HttpResponseException(ResponseHelper::jsonResponse([],\n                \"You are not authorized to {$action} this {$modelType}.\",\n                403, false));\n        }\n    }\n\n    public function checkProduct($model, $modelType, $action)\n    {\n        $hasProducts = Store::where('category_id', $model->id)->exists();\n\n        $userHasStoreInCategory = Store::where('category_id', $model->id)\n            ->where('user_id', auth()->id())\n            ->exists();\n        if ($action == 'delete' && $hasProducts) {\n            $productNotOwnedByUser = Store::where('category_id', $model->id)->where('user_id', '!=', auth()->id())->exists();\n            if ($productNotOwnedByUser) {\n                throw new HttpResponseException(ResponseHelper::jsonResponse(\n                    [],\n                    \"You are not authorized to {$action} this {$modelType}. This store have product from other users.\",\n                    403,\n                    false\n                ));\n            }\n        }\n        if ($hasProducts && ! $userHasStoreInCategory && $action == 'update') {\n            throw new HttpResponseException(ResponseHelper::jsonResponse(\n                [],\n                \"You are not authorized to {$action} this {$modelType}. You must have products in this category.\",\n                403,\n                false\n            ));\n        }\n    }\n}"
        }
    ]
}