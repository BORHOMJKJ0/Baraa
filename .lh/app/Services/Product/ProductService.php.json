{
    "sourceFile": "app/Services/Product/ProductService.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 4,
            "patches": [
                {
                    "date": 1746894862347,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1746894873224,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,9 +3,9 @@\n namespace App\\Services\\Product;\n \n use App\\Helpers\\ResponseHelper;\n use App\\Http\\Resources\\Product\\ProductResource;\n-use App\\Http\\Requests\\Product\\CreateRequest;\n+use App\\Http\\Requests\\Product\\CreateProductRequest;\n use App\\Models\\Product\\Product;\n use App\\Repositories\\Product\\ProductRepository;\n use App\\Traits\\AuthTrait;\n use Illuminate\\Http\\Exceptions\\HttpResponseException;\n@@ -55,9 +55,9 @@\n \n         return ResponseHelper::jsonResponse($data, 'Product retrieved successfully!');\n     }\n \n-    public function createProduct(array $data, ProductCreateRequest $request): JsonResponse\n+    public function createProduct(array $data,CreateProductRequest $request): JsonResponse\n     {\n         try {\n             $data['user_id'] = auth()->id();\n             $path = $request->hasFile('image') ? $request->file('image')->store('images', 'public') : null;\n"
                },
                {
                    "date": 1746894956705,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -58,9 +58,8 @@\n \n     public function createProduct(array $data,CreateProductRequest $request): JsonResponse\n     {\n         try {\n-            $data['user_id'] = auth()->id();\n             $path = $request->hasFile('image') ? $request->file('image')->store('images', 'public') : null;\n             $data['image'] = $path;\n             $product = $this->productRepository->create($data);\n             $data = [\n"
                },
                {
                    "date": 1746895173323,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -76,9 +76,9 @@\n \n     public function updateProduct(Product $product, array $data)\n     {\n         try {\n-            $this->checkOwnership($product, 'Product', 'update','Store');\n+            $this->checkOwnership($product, 'Product', 'update','Store',);\n             if (isset($data['image'])) {\n                 if ($product->image && Storage::disk('public')->exists($product->image)) {\n                     Storage::disk('public')->delete($product->image);\n                 }\n"
                },
                {
                    "date": 1746895204695,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -76,9 +76,9 @@\n \n     public function updateProduct(Product $product, array $data)\n     {\n         try {\n-            $this->checkProdc($product, 'Product', 'update');\n+            $this->checkProduct($product, 'Product', 'update');\n             if (isset($data['image'])) {\n                 if ($product->image && Storage::disk('public')->exists($product->image)) {\n                     Storage::disk('public')->delete($product->image);\n                 }\n@@ -108,5 +108,5 @@\n         }\n         return $response;\n     }\n \n-}\n\\ No newline at end of file\n+}\n"
                }
            ],
            "date": 1746894862347,
            "name": "Commit-0",
            "content": "<?php\n\nnamespace App\\Services\\Product;\n\nuse App\\Helpers\\ResponseHelper;\nuse App\\Http\\Resources\\Product\\ProductResource;\nuse App\\Http\\Requests\\Product\\CreateRequest;\nuse App\\Models\\Product\\Product;\nuse App\\Repositories\\Product\\ProductRepository;\nuse App\\Traits\\AuthTrait;\nuse Illuminate\\Http\\Exceptions\\HttpResponseException;\nuse Illuminate\\Http\\JsonResponse;\nuse Illuminate\\Http\\Request;\nuse Illuminate\\Support\\Facades\\Storage;\nuse Illuminate\\Support\\Facades\\Validator;\n\nclass ProductService\n{\n    use AuthTrait;\n\n    public function __construct(protected ProductRepository $productRepository){}\n\n    public function getAllProducts(Request $request)\n    {\n        $items = $request->query('items', 20);\n        $column = $request->query('column', 'name');\n        $direction = $request->query('direction', 'asc');\n        $validColumns = ['name', 'price', 'amount'];\n        $validDirections = ['asc', 'desc'];\n\n        if (!in_array($column, $validColumns) || !in_array($direction, $validDirections)) {\n            return ResponseHelper::jsonResponse(\n                [],\n                'Invalid sort column or direction. Allowed columns: ' . implode(', ', $validColumns) .\n                '. Allowed directions: ' . implode(', ', $validDirections) . '.',\n                400,\n                false\n            );\n        }\n        $products = $this->productRepository->getAll($items, $column, $direction);\n\n        $data = [\n            'Products' => ProductResource::collection($products),\n            'total_pages' => $products->lastPage(),\n            'current_page' => $products->currentPage(),\n            'hasMorePages' => $products->hasMorePages(),\n        ];\n\n        return ResponseHelper::jsonResponse($data, 'Products retrieved successfully');\n    }\n\n    public function getProductById(Product $product)\n    {\n        $data = ['product' => ProductResource::make($product)];\n\n        return ResponseHelper::jsonResponse($data, 'Product retrieved successfully!');\n    }\n\n    public function createProduct(array $data, ProductCreateRequest $request): JsonResponse\n    {\n        try {\n            $data['user_id'] = auth()->id();\n            $path = $request->hasFile('image') ? $request->file('image')->store('images', 'public') : null;\n            $data['image'] = $path;\n            $product = $this->productRepository->create($data);\n            $data = [\n                'Product' => ProductResource::make($product),\n            ];\n\n            $response = ResponseHelper::jsonResponse($data, 'Product created successfully!', 201);\n        } catch (HttpResponseException $e) {\n            $response = $e->getResponse();\n        }\n\n        return $response;\n    }\n\n    public function updateProduct(Product $product, array $data)\n    {\n        try {\n            $this->checkOwnership($product, 'Product', 'update');\n            if (isset($data['image'])) {\n                if ($product->image && Storage::disk('public')->exists($product->image)) {\n                    Storage::disk('public')->delete($product->image);\n                }\n                $path = $data['image']->store('images', 'public');\n                $data['image'] = $path;\n            }\n            $product = $this->productRepository->update($product, $data);\n            $data = [\n                'Product' => ProductResource::make($product),\n            ];\n            $response = ResponseHelper::jsonResponse($data, 'Product updated successfully!');\n        } catch (HttpResponseException $e) {\n            $response = $e->getResponse();\n        }\n\n        return $response;\n    }\n\n    public function deleteProduct(Product $product)\n    {\n        try {\n            $this->checkOwnership($product, 'Product', 'delete');\n            $this->productRepository->delete($product);\n            $response = ResponseHelper::jsonResponse([], 'Product deleted successfully!');\n        } catch (HttpResponseException $e) {\n            $response = $e->getResponse();\n        }\n        return $response;\n    }\n\n}"
        }
    ]
}